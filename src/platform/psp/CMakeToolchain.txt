execute_process(COMMAND psp-config --pspdev-path OUTPUT_VARIABLE PSPDEV)
execute_process(COMMAND psp-config --pspsdk-path OUTPUT_VARIABLE PSPSDK)
string(STRIP ${PSPDEV} toolchain_dir)
string(STRIP ${PSPSDK} sdk_dir)

set(cross_prefix "${toolchain_dir}/bin/psp-")

set(link_flags "-L${sdk_dir}/lib -specs=${sdk_dir}/lib/prxspecs -Wl,-q,-T${sdk_dir}/lib/linkfile.prx -lc")
set(inc_flags "-I${sdk_dir}/include")

set(CMAKE_SYSTEM_NAME Generic CACHE INTERNAL "system name")
set(CMAKE_SYSTEM_PROCESSOR mips CACHE INTERNAL "processor")
set(CMAKE_AR ${cross_prefix}ar CACHE INTERNAL "archiver")
set(CMAKE_C_COMPILER ${cross_prefix}gcc CACHE INTERNAL "c compiler")
set(CMAKE_CXX_COMPILER ${cross_prefix}g++ CACHE INTERNAL "cxx compiler")
set(CMAKE_ASM_COMPILER ${cross_prefix}gcc CACHE INTERNAL "assembler")
set(common_flags "${arch_flags} ${inc_flags} -G0")
set(CMAKE_C_FLAGS ${common_flags} CACHE INTERNAL "c compiler flags")
set(CMAKE_ASM_FLAGS ${common_flags} CACHE INTERNAL "c compiler flags")
set(CMAKE_CXX_FLAGS ${common_flags} CACHE INTERNAL "cxx compiler flags")
set(CMAKE_LINKER ${cross_prefix}gcc CACHE INTERNAL "linker")
set(CMAKE_STRIP ${cross_prefix}strip CACHE INTERNAL "strip")

set(MKSFO "${toolchain_dir}/bin/mksfo")
set(MKSFOEX "${toolchain_dir}/bin/mksfoex")
set(PACK_PBP "${toolchain_dir}/bin/pack-pbp")
set(FIXUP "${toolchain_dir}/bin/psp-fixup-imports")
set(PRXGEN "${toolchain_dir}/bin/psp-prxgen")

set(CMAKE_EXE_LINKER_FLAGS ${link_flags} CACHE INTERNAL "exe link flags")
set(CMAKE_MODULE_LINKER_FLAGS ${link_flags} CACHE INTERNAL "module link flags")
set(CMAKE_SHARED_LINKER_FLAGS ${link_flags} CACHE INTERNAL "shared link flags")

set(PSP ON)
